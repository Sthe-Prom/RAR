@inject SignInManager<User> signInManager;
@inject UserManager<User> userManager;

@model AccidentReportViewModel

@{
    var userId = userManager.GetUserId(User);
    User user = await userManager.FindByIdAsync(userId);
}

<style>
    #accordionFlushExample1 .card{
        background-color: #F5F7FB;
    }

    #accordionFlushExample1 .card:hover{
        /* border-radius: 2px; */
        /* border: 1px solid #222E3C; */
        background-color: #F5F7FB;
        transition: 0.1s ease;  
        /* color: #F5F7FB;    */
    }

    .customSwalBtn{
		background-color: rgba(214,130,47,1.00);
        border-left-color: rgba(214,130,47,1.00);
        border-right-color: rgba(214,130,47,1.00);
        border: 0;
        border-radius: 3px;
        box-shadow: none;
        color: #fff;
        cursor: pointer;
        font-size: 17px;
        font-weight: 500;
        margin: 30px 5px 0px 5px;
        padding: 10px 32px;
        text-decoration: none;
	}


    .canvas_body {
        background: #e74c3c;
    }

    #canvas {
    position: relative;
    left: calc(50% - 390px);
    top: 50px;
    border: 1px solid black;
    cursor: crosshair;
    background: #ecf0f1;
    }

    .canvas-container{
        border: 2px solid #ccc;
    }

    .canvas{
        border: 1px solid #fff;
        display: block;
    }



</style>

<div class="container-fluid p-0">
 
    <div class="d-flex flex-row justify-content-between">  

        <div class="col-auto">                                                
            <h4 class="h3 mb-3" style="line-height:40px;">Managing Accident Reports</h4>                
        </div>    
           
    </div>

     @if(!string.IsNullOrEmpty(ViewBag.Result))
        {
            <div class="alert alert-success" role="alert">
                <p>Success Banner: @ViewBag.Result</p>
            </div>

        }
    
    <div class="row">
        <div class="col-12">

            <div class="accordion accordion-flush" id="accordionFlushExample1">
                <!-- Accident Identification Details    -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingOne1" >                   
                        <button class="accordion-button collapsed btn btn-lg btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse1" aria-expanded="false" aria-controls="flush-collapseOne"> 
                            Accident Identification Details                        
                        </button>                                        
                    </h2>                
                    <div id="flush-collapse1" class="accordion-collapse collapse accordion-body" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample1">
                        
                        <div class="d-flex flex-row justify-content-between row">
                            
                            <div class="col-sm-12">
                                <h4 class="mb-1 mt-1">Accident Identification Details </h4>
                                <hr />
                            </div>

                            <form asp-action="AddReport" method="post" id="frmAddReport">                                
                                                                
                                <!-- <input type="hidden" asp-for="@Model.AccidentReport.AccidentReportID" id="@Model.AccidentReport.AccidentReportID" name="AccidentReportID" /> -->

                                <div asp-validation-summary="All"></div>

                                @* <div class="col-sm-6" style="margin:0 auto; float: none;">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Accident ID</h5>
                                        </div>
                                        <div class="card-body">
                                            <input type="text" asp-for="@Model.AccidentReport.AccidentID" class="form-control" placeholder="Accident ID">
                                            <div><span asp-validation-for="@Model.AccidentReport.AccidentID" class="text-danger"></span></div>
                                        </div>
                                    </div>
                                </div> *@

                                <div class="row"> 
                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Accident Date</h5>
                                            </div>
                                            <div class="card-body">
                                                <input type="date" id="AccDate" asp-for="@Model.AccidentReport.AccidentDate" class="form-control" placeholder="Accident Date">
                                                <div><span asp-validation-for="@Model.AccidentReport.AccidentDate" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Accident Time</h5>
                                            </div>
                                            <div class="card-body">
                                                <input type="time" value="12:00" asp-for="@Model.AccidentReport.AccidentTime" class="form-control" placeholder="Accident Time">
                                                <div><span asp-validation-for="@Model.AccidentReport.AccidentTime" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">                                                 
                                                <h5 class="card-title mb-0">
                                                    <span class="" data-bs-toggle="tooltip" data-bs-placement="top" title="Click to get device's' current location." required="">
                                                        Accident Location 
                                                        <a onclick="getLocation()">
                                                            <i class="align-middle" data-feather="map-pin"></i>    
                                                        </a>
                                                    </span>
                                                </h5>
                                            </div>
                                            <div class="card-body">                                                                                                                                                  
                                                <input type="text" id="AccidentLocation" asp-for="@Model.AccidentReport.AccidentLocation"  class="form-control" placeholder="Accident Location" required>
                                                
                                                <div><span id="valAccLoc" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-8 text-center center">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Accident Description</h5>
                                            </div>
                                            <div class="card-body">
                                                <textarea type="text" row="3" id="AccidentDescription" asp-for="@Model.AccidentReport.AccidentDescription" class="form-control" placeholder="Accident Description" required></textarea>
                                                <div><span asp-validation-for="@Model.AccidentReport.AccidentDescription" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-4 text-center center">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Accident Picture</h5>
                                            </div>
                                        </div>
                                        <div class="card-body custom-file">                                        
                                            <input asp-for="@Model.AccidentPicture" accept="image/gif, image/jpeg" class="custom-file-input form-control" id="AccidentPicture" type="file" />                                
                                            <span asp-validation-for="@Model.AccidentPicture" class="text-danger"></span>                                        
                                        </div>
                                    </div>

                                     <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Type of Collision</h5>
                                            </div>
                                            <div class="card-body">
                                                <select class="form-select mb-3" id="CollisionType" asp-for="@Model.AccidentReport.CollisionID" asp-items="Model.Collisions" required >
                                                    <option value="" selected>Select Collision Type</option>
                                                </select>
                                                <div><span asp-validation-for="@Model.AccidentReport.CollisionID" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Number of People Killed</h5>
                                            </div>
                                            <div class="card-body">
                                                <input type="number" min="0" asp-for="@Model.AccidentReport.NrPeopleKilled" class="form-control" placeholder="Number of Peope Killed">
                                                <div><span asp-validation-for="@Model.AccidentReport.NrPeopleKilled" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Number of People Injured</h5>
                                            </div>
                                            <div class="card-body">
                                                <input type="number" min="0" asp-for="@Model.AccidentReport.NrPeopleInjured" class="form-control" placeholder="Number of Peope Injured">
                                                <div><span asp-validation-for="@Model.AccidentReport.NrPeopleInjured" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Province</h5>
                                            </div>
                                            <div class="card-body">
                                                <select class="form-select mb-3" id="Province" required> @*asp-items="Model.Provinces_Select" >*@
                                                    <option value=""selected>Select Province</option> 
                                                    <option value="1" disabled>Gauteng</option> 
                                                    <option value="2" >Free State</option> 
                                                    <option value="3" disabled>Eastern Cape</option> 
                                                    <option value="4" disabled>Western Cape</option> 
                                                    <option value="5" disabled>North West</option> 
                                                    <option value="6" disabled>Kwa-Zulu Natal</option> 
                                                    <option value="7" disabled>Mpumalanga</option> 
                                                    <option value="8" disabled>Limpopo</option>
                                                    <option value="9" disabled>Northen Cape</option>                                                                                       
                                                </select>
                                                <div><span class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">City</h5>
                                            </div>
                                            <div class="card-body">
                                                <select class="form-select mb-3" id="City" required> @*asp-items="Model.District_Select" >*@
                                                    <option value="City" selected>Select City</option>
                                                    <option >Bloemfontein</option>
                                                    <option disabled>Clarens</option>
                                                    <option disabled>Welkom</option>                                   
                                                    <option disabled>Parys</option>
                                                    <option disabled>Ladybrand</option>
                                                </select>
                                                <div><span class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Police Station</h5>
                                            </div>
                                            <div class="card-body">
                                                <select class="form-select mb-3" id="PoliceStation" asp-for="@Model.AccidentReport.PoliceStationID" asp-items="Model.PoliceStations_Select" required >
                                                    <option value="" selected>Select Police Station</option>
                                                </select>
                                                <div><span asp-validation-for="@Model.AccidentReport.PoliceStationID" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>
                                  
                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Type of Accident</h5>
                                            </div>
                                            <div class="card-body">
                                                <select class="form-select mb-3" id="AccidentType" asp-for="@Model.AccidentReport.AccidentTypeID" asp-items="Model.AccidentTypes_Select" required >
                                                    <option value="" selected>Select Accident Type</option>                                     
                                                </select>
                                                <div><span asp-validation-for="@Model.AccidentReport.AccidentTypeID" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 asp-for="@Model.AccidentReport.HitAndRun" class="card-title mb-0">Hit & Run ?</h5>
                                            </div>
                                            <div class="card-body">
                                                <div>
                                                    <label class="form-check">
                                                        <input
                                                            class="form-check-input"
                                                            type="radio"
                                                            value="True"
                                                            asp-for="@Model.AccidentReport.HitAndRun"
                                                            checked />
                                                        <span class="form-check-label">
                                                            Yes
                                                        </span>
                                                    </label>
                                                    <label class="form-check form-check-inline">
                                                        <input
                                                            class="form-check-input"
                                                            type="radio"
                                                            value="False"
                                                            asp-for="@Model.AccidentReport.HitAndRun"                                                            
                                                            />
                                                        <span class="form-check-label">
                                                        No
                                                        </span>
                                                    </label>                                            
                                                </div>
                                               
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Type of Weather</h5>
                                            </div>
                                            <div class="card-body">
                                                <select class="form-select mb-3" id="WeatherType" asp-for="@Model.AccidentReport.WeatherTypeID" asp-items="Model.WeatherTypes" required>
                                                    <option value="" selected>Select Weather Type</option>                                    
                                                </select>
                                                <div><span asp-validation-for="@Model.AccidentReport.WeatherTypeID" class="text-danger"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 text-center center" >
                                        <div class="card">    
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Accident Sketch</h5>
                                            </div>   
                                            <div class="card-body">                                               
                                                <div class="col-md-12 col-lg-12">
                                                    
                                                    <div class="form-group">
                                                        <div class="canvas-container"> 
                                                            <canvas class="canvas" id="drawingCanvas" width="800" height="400"></canvas>
                                                        </div>
                                                    </div>
                                                    <button id="clearButton" class="btn btn-secondary">Clear</button>

                                                </div>
                                            </div>
                                        </div>
                                    </div>                                   

                                </div>

                                <div class="text-center">
                                    <button type="submit" id="submitAddReport" onclick="validateAddReportForm()" class="btn btn-primary">Save Accident Details</button>                 
                                    <a href="~/AccidentReport/AddReport" class="btn btn-secondary">Cancel</a>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>

                <!-- Road Related Details -->
                <div class="accordion-item">
                    <h2 class="accordion-header " id="flush-headingOne5" >                   
                        <button class="accordion-button collapsed btn btn-lg btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse5" aria-expanded="false" aria-controls="flush-collapseOne"> 
                             Road Related Details                    
                        </button>                                        
                    </h2>                
                    <div id="flush-collapse5" class="accordion-collapse collapse accordion-body" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample1">
                        <div class="d-flex flex-row justify-content-between row">
                            <div class="col-sm-12">
                                <h4 class="mb-1 mt-1">Road Related Details</h4>
                                <hr />
                            </div>

                                <form asp-action="AddRoadFactors" id="frmAddRoadFactors" method="post">
                                    <div class="d-flex flex-row justify-content-between row">
                                        
                                        <!-- User Accidents -->
                                        <!-- <div class="row">
                                            <div class="col-sm-8 text-center" style="margin: 0 auto; float:none;" >
                                                
                                                <div class="card">
                                                    
                                                    <div class="card-header">
                                                        <h4 class="mb-0">Road Related Details for Accident:</h4>
                                                        <hr />
                                                    </div>
                                                    <div class="card-body">                                                     
                                                        @Html.DropDownList("@Model.AccidentReport.AccidentReportID",(IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)ViewBag.UserAccidentReports, null, new { @class ="form-control" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div> -->

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Road Name</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" asp-for="@Model.RoadFactor.RoadName" id="RoadName" class="form-control" placeholder="Road Name" required>
                                                    <div><span asp-validation-for="@Model.RoadFactor.RoadName" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Road Number</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" asp-for="@Model.RoadFactor.RoadNumber" id="RoadNumber" class="form-control" placeholder="Road Number" required>
                                                    <div><span asp-validation-for="@Model.RoadFactor.RoadNumber" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Landmark</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" id="Landamrk" asp-for="@Model.RoadFactor.Landmark" class="form-control" placeholder="Landmark" required>
                                                    
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Physical Divider</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input"
                                                                type="radio"
                                                                value="True"                                                       
                                                                asp-for="@Model.RoadFactor.PhysicalDivider"/>
                                                            <span class="form-check-label">
                                                                Yes
                                                            </span>
                                                        </label>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input"
                                                                type="radio"
                                                                value="False"
                                                                asp-for="@Model.RoadFactor.PhysicalDivider"                                                               
                                                               />
                                                            <span class="form-check-label">
                                                                No
                                                            </span>
                                                        </label>                                                
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Ongoing Road Works</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input"
                                                                type="radio"
                                                                value="True"                                                                
                                                                asp-for="@Model.RoadFactor.OnGoingRoadWorks" />
                                                            <span class="form-check-label">
                                                                Yes
                                                            </span>
                                                        </label>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input"
                                                                type="radio"
                                                                value="False"
                                                                asp-for="@Model.RoadFactor.OnGoingRoadWorks" />
                                                            <span class="form-check-label">
                                                                No
                                                            </span>
                                                        </label>                                                
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Road Type</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="RoadType" asp-for="@Model.RoadFactor.RoadTypeID" asp-items="Model.RoadType_Select" required>
                                                        <option value="" selected>Select Road Type</option>
                                                    </select>
                                                    <div><span asp-validation-for="@Model.RoadFactor.RoadTypeID" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Road Feature</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="RoadFeature" asp-for="@Model.RoadFactor.RoadFeatureID" asp-items="Model.RoadFeature_Select" required>
                                                        <option value="" selected>Select Road RoadFeature</option>
                                                    </select>
                                                    <div><span asp-validation-for="@Model.RoadFactor.RoadFeatureID" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Road Surface</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="RoadSurface"  asp-for="@Model.RoadFactor.RoadSurfaceID" asp-items="Model.RoadSurface_Select" required>
                                                        <option value="" selected>Select Road Surface</option>
                                                    </select>
                                                    <div><span asp-validation-for="@Model.RoadFactor.RoadSurfaceID" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Surface Condition</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="SurfaceCondition" asp-for="@Model.RoadFactor.SurfaceConditionID" asp-items="Model.SurfaceCondition_Select" required>
                                                        <option value="" selected>Select Surface Condition</option>
                                                    </select>
                                                    <div><span asp-validation-for="@Model.RoadFactor.SurfaceConditionID" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Road Surface Quality</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="SurfaceQuality" asp-for="@Model.RoadFactor.RoadSurfaceQualityID" asp-items="Model.RoadSurfaceQuality_Select" required>
                                                        <option value="" selected>Select Surface Quality</option>
                                                    </select>
                                                    <div><span asp-validation-for="@Model.RoadFactor.RoadSurfaceQualityID" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Speed Limit</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="SpeedLimit" asp-for="@Model.RoadFactor.SpeedLimitID" asp-items="Model.SpeedLimit_Select" required >
                                                        <option value="" selected>Select Speed Limit</option>
                                                    </select>
                                                    <div><span asp-validation-for="@Model.RoadFactor.SpeedLimitID" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Lane</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="Lane" asp-for="@Model.RoadFactor.LaneID" asp-items="Model.Lane_Select" required>
                                                        <option value="" selected>Select Road Lane</option>
                                                    </select>
                                                    <div><span asp-validation-for="@Model.RoadFactor.LaneID" class="text-danger"></span></div>
                                                </div>
                                            </div>
                                        </div>
                                
                                        <div class="text-center">
                                            <button type="submit" id="submitAddRoadFactors" onclick="validateAddRoadFactorsForm()" class="btn btn-primary text-center">
                                                Save Road Factors                                        
                                            </button>   
                                            <a href="~/AccidentReport/AddReport" class="btn btn-secondary">Cancel</a>
                                        </div>
                                    
                                    </div>
                                </form>
                           
                        </div>
                    </div>
                </div>

                <!-- Vehicle Details -->
                <div class="accordion-item">
                    <h2 class="accordion-header " id="flush-headingOne2" >                   
                        <button class="accordion-button collapsed btn btn-lg btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse2" aria-expanded="false" aria-controls="flush-collapseOne"> 
                            Vehicle Details                    
                        </button>                                                            
                    </h2>                 
                    <div id="flush-collapse2" class="accordion-collapse collapse accordion-body" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample1">
                        <div class="d-flex flex-row justify-content-between row">
                          
                            <div id="">
                                <div class="col-sm-12">
                                    <h4 class="mb-1 mt-1">Vehicle Details</h4>
                                    <hr />
                                </div>

                                <div class="d-flex flex-row justify-content-center row mb-2" style="margin:0 auto;float:none;">
                                    <button class="btn btn-success col-auto mb-2" style="padding: 5px;" onclick="addVehicle()">Add Vehicle</button>
                                </div>

                               

                                <form asp-action="AddVehicle" method="post" id="frmAddVehicle"  >

                                      <!-- User Accidents -->
                                    <!-- <div class="row">
                                        <div class="col-sm-8 text-center" style="margin: 0 auto; float:none;" >
                                            
                                            <div class="card">
                                                
                                                <div class="card-header">
                                                    <h4 class="mb-0">Vehicle Related Details for Accident:</h4>
                                                    <hr />
                                                </div>
                                                <div class="card-body">                                                     
                                                    @Html.DropDownList("@Model.AccidentReport.AccidentReportID",(IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)ViewBag.UserAccidentReports, null, new { @class ="form-control" })
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->

                                    <div class="d-flex flex-row justify-content-center row">
                                        <div class="col-sm-4">
                                            <div class="card card-secondary">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Vehicle Registeration Number</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" id="VehicleRegistrationNr" asp-for="@Model.Vehicle.RegistrationNumber" class="form-control" placeholder="Vehicle Registeration Number" required>
                                                </div>
                                            </div>
                                        </div>

                                         <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Vehicle Owner</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3"  id="VehicleOwner" asp-for="@Model.Vehicle.VehicleOwnerID" asp-items="Model.VehicleOwner_Select" required>
                                                        <option value="" selected>Select Vehicle Owner</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card card-primary">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Type of Vehicle</h5>
                                                </div>

                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="Vehicletype"  asp-for="@Model.Vehicle.VehicleTypeID" asp-items="Model.VehicleType_Select" required>
                                                        <option value="" selected>Select Type of Vehicle</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Load Type</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="LoadType" asp-for="@Model.Vehicle.LoadTypeID" asp-items="Model.LoadType_Select" required>
                                                        <option value="" selected>Select Type of Load</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Load Condition</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="LoadCondition" asp-for="@Model.Vehicle.LoadConditionID" asp-items="Model.LoadCondition_Select" required>
                                                        <option value="" selected>Select Load Condition</option>                                                                                   
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Mechanical Failure</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input"
                                                                type="radio"
                                                                value="True"  
                                                                asp-for="@Model.Vehicle.MechanicalFailure"                                                  
                                                                checked />
                                                            <span class="form-check-label">
                                                                Yes
                                                            </span>
                                                        </label>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input"
                                                                type="radio"
                                                                value="False"
                                                                asp-for="@Model.Vehicle.MechanicalFailure" />
                                                            <span class="form-check-label">
                                                            No
                                                            </span>
                                                        </label>                                            
                                                    </div>
                                                </div>
                                            </div>      
                                        </div>  


                                        <div class="text-center">
                                            <button type="submit" id="submitAddVehicle" onclick="validateAddVehicleForm()" class="btn btn-primary text-center">
                                                Save Vehicle Details                                        
                                            </button>   
                                            <a href="~/AccidentReport/AddReport" class="btn btn-secondary">Cancel</a>
                                        </div>
                                    </div>
                                    
                                </form>
                            </div>
                           
                        </div>
                    </div>
                </div>

                <!-- Drivers Details -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingOne2" >                   
                        <button class="accordion-button collapsed btn btn-lg btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse3" aria-expanded="false" aria-controls="flush-collapseOne"> 
                            Drivers Details                       
                        </button>                                        
                    </h2>                
                    <div id="flush-collapse3" class="accordion-collapse collapse accordion-body mb-5" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample1">
                        <div class="d-flex flex-row justify-content-center row">

                            <div class="d-flex flex-row justify-content-center row" style="margin:0 auto;float:none;">
                                <button class="btn btn-success col-auto" style="padding: 5px;" onclick="addDriverInfor()">Add Driver</button>
                            </div>
                                                  
                            <div id="">
                                <div class="col-sm-12">
                                    <h4 class="mb-1 mt-1">Driver Details</h4>
                                    <hr />
                                </div>

                                <form asp-action="AddDriverInformation" id="frmAddDriverInfor" method="post">
                                
                                    <div class="d-flex flex-row justify-content-center row">

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Vehicle Driver Owner</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="VehicleDriverOwner" asp-for="@Model.DriverInfor.VehicleID" asp-items="Model.VehicleDriverOwner_Select" required>
                                                        <option value="" selected>Select Vehicle Driver Owner</option>                                                                                   
                                                    </select>
                                                </div>
                                            </div>      
                                        </div> 

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Driver Name</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" id="Name" asp-for="@Model.DriverInfor.Name" class="form-control" placeholder="Driver Name" required>
                                                    <div><span asp-validation-for="@Model.DriverInfor.Name" class="text-danger"></span></div>
                                                </div>
                                            </div>      
                                        </div>
                                    
                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Driver Surname</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" id="Surname" asp-for="@Model.DriverInfor.Surname" class="form-control" placeholder="Driver Surname" required>
                                                    <div><span asp-validation-for="@Model.DriverInfor.Surname" class="text-danger"></span></div>                                            
                                                </div>
                                            </div>      
                                        </div> 

                                         <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Driver PhoneNumber</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" id="PhoneNumber" asp-for="@Model.DriverInfor.PhoneNumber" class="form-control" placeholder="Driver PhoneNumber" required>
                                                    <div><span asp-validation-for="@Model.DriverInfor.PhoneNumber" class="text-danger"></span></div>                                            
                                                </div>
                                            </div>      
                                        </div> 

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Driver Address</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" id="Address" asp-for="@Model.DriverInfor.Address" class="form-control" placeholder="Driver Address" required>
                                                    <div><span asp-validation-for="@Model.DriverInfor.Address" class="text-danger"></span></div>                                            
                                                </div>
                                            </div>      
                                        </div> 

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Driver Race</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="Race" asp-for="@Model.DriverInfor.Race" required>
                                                        <option value="" selected>Select Race</option>
                                                        <option value="African">African</option>
                                                        <option value="White">White</option>   
                                                        <option value="Indian">Indian</option>
                                                        <option value="Coloured">Coloured</option> 
                                                        <option value="Unknown">Unknown</option>                                          
                                                    </select>
                                                </div>
                                            </div>      
                                        </div>                           

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Driver Gender</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="Gender" asp-for="@Model.DriverInfor.Gender" required>
                                                        <option value="" selected>Select Gender</option>
                                                        <option value="Male">Male</option>
                                                        <option value="Female">Female</option>                                          
                                                    </select>
                                                </div>
                                            </div>      
                                        </div>  
                                        
                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Driver License</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="License" asp-for="@Model.DriverInfor.LicenceID" asp-items="Model.Licence_Select" required>
                                                        <option selected>Select License Type</option>                                                                                   
                                                    </select>
                                                </div>
                                            </div>      
                                        </div>      

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Licence Reg. Number</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="text" id="LicenseRegNumber" asp-for="@Model.DriverInfor.LicenceNumber" class="form-control" placeholder="Driver Licence Number" required>
                                                    <div><span asp-validation-for="@Model.DriverInfor.LicenceNumber" class="text-danger"></span></div>                                            
                                                </div>
                                            </div>      
                                        </div>           
                                        
                                        <div class="col-sm-4">    
                                            <div class="card">     
                                                <div class="card-header">
                                                    Alcohol / Substance Use
                                                </div>                                        
                                                <div class="card-body">
                                                    <div>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input form-check-inline"
                                                                type="checkbox"
                                                                value="@Model.DriverInfor.AlcoholSuspected" />
                                                            <span class="form-check-label">
                                                                Alcohol Suspected
                                                            </span>
                                                        </label>                 
                                                    
                                                    </div>
                                                    <div>
                                                         <label class="form-check">
                                                            <input
                                                                class="form-check-input form-check-inline"
                                                                type="checkbox"
                                                                value="@Model.DriverInfor.AlcoholTested" />
                                                            <span class="form-check-label">
                                                                Alcohol Tested
                                                            </span>
                                                        </label>
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>  
                                        </div>   

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Safety Device Used</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="SafetyDeviceUsed" asp-for="@Model.DriverInfor.SafetyDevice" required>
                                                        <option value="" selected>Select Device Used</option>
                                                        <option value="Seatbelt">Seatbelt</option>
                                                        <option value="Helmet">Helmet</option>   
                                                        <option value="Unknown">Unknown</option>   
                                                        <option value="None">None</option>                                        
                                                    </select>
                                                </div>
                                            </div>      
                                        </div>

                                        <div class="col-sm-4">                               
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Type of Traffic Violation</h5>
                                                </div>
                                                <div class="card-body">
                                                    <select class="form-select mb-3" id="TrafficViolation" asp-for="@Model.DriverInfor.TrafficViolationID" asp-items="Model.TrafficViolation_Select" required>
                                                        <option value="" selected>Select Type of Traffic Violation</option>                                                                                     
                                                    </select>
                                                </div>
                                            </div>      
                                        </div>

                                        <div class="text-center">
                                            <button type="submit" id="submitAddDriverInfor" onclick="validateAddDriverInforForm()" class="btn btn-primary text-center">
                                                Save Driver Information                                        
                                            </button>   
                                            <a href="~/AccidentReport/AddReport" class="btn btn-secondary">Cancel</a>
                                        </div>
                                    </div>

                                </form>
                            </div>

                        </div>
                    </div>
                    
                    <hr />
                    
                </div>
                @{
                    //Data Confirmation
                  
                    @if(await userManager.IsInRoleAsync(user,"Data Manager"))
                     {
                        <div class="accordion-item">
                            <h2 class="accordion-header " id="flush-headingOne5" >                   
                                <button class="accordion-button collapsed btn btn-lg btn-outline-danger" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse5" aria-expanded="false" aria-controls="flush-collapseOne"> 
                                    Data Confirmation              
                                </button>                                        
                            </h2>  

                            <div id="flush-collapse5" class="accordion-collapse collapse accordion-body" style="margin: 2px;" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample1">
                                <div class="d-flex flex-row justify-content-between row">
                                    <div class="col-sm-12">
                                        <h4 class="mb-1 mt-1">Data Manager Signature</h4>
                                        <hr />
                                    </div>  
                                    <div class="col-auto mt-2 mb-2 text-center">

                                        <div class="col-sm-12" style="margin:0 auto;float:none;">                               
                                            <div class="card">
                                             
                                                <div class="card-body">
                                                    <div>
                                                        <label class="form-check">
                                                            <input
                                                                class="form-check-input"
                                                                type="checkbox"
                                                                value="@Model.AccidentReport.AccidentReportID"
                                                              
                                                                 />
                                                            <span class="form-check-label">
                                                                confirm that I have read the road accident data as recorded by the officer.
                                                            </span>
                                                        </label>                                                      
                                                    
                                                    </div>
                                                </div>
                                            </div>      
                                        </div>  
                                       
                                        <form asp-action="ConfirmReport" method="post">
                                            <input type="hidden" asp-for="@Model.AccidentReport.AccidentReportID"  />
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                Confirm Form Data
                                            </button>
                                        </form>
                                    </div>                                            

                                </div>
                            </div>
                        </div>
                    }
                }

                <!-- Complete -->
                <div class="accordion-item">
                    <h2 class="accordion-header " id="flush-headingOne2" >                   
                        <button class="accordion-button collapsed btn btn-lg btn-outline-success" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse4" aria-expanded="false" aria-controls="flush-collapseOne"> 
                            Complete Report                      
                        </button>                                        
                    </h2>  

                    <div id="flush-collapse4" class="accordion-collapse collapse accordion-body" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample1">
                        <div class="d-flex flex-row justify-content-between row " style="padding: 5px;maring:3px;">
                            <div class="">
                                <div class="col-sm-12">
                                    <h4 class="mb-1 mt-1">Submit Report</h4>
                                    
                                </div>  
                                <div class="col-auto">
                                    <div class="" role="alert">
    
                                        <h5 class="text-center">
                                            <span class="h3 mb-3" style="margin:3px;padding: 5px;">Complete Report Submission</span>                                           
                                        <h5>
                                         <p class="text-center">Reports may take up to 24 Hours for review, you will receive 
                                            feedback from your report after review by data manager.
                                        </p>
                                    
                                    </div>
                                </div>
                                <div class="text-center">
                                    <a class="btn btn-md btn-success" onclick="ReportComplete()">
                                        Save Report
                                    </a>
                                </div>
                            </div>                                            

                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

</div>


<script>        

    const x = document.getElementById("AccidentLocation");

    //Geo-Location [HTML5 JS] - API
    function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else { 
        x.value = "Geolocation is not supported by this browser.";
    }
    }

    //Get LAt. and Long.
    function showPosition(position) {
    x.value = position.coords.latitude + "," + position.coords.longitude;
    }

    function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
        x.innerHTML = "User denied the request for Geolocation."
        break;
        case error.POSITION_UNAVAILABLE:
        x.innerHTML = "Location information is unavailable."
        break;
        case error.TIMEOUT:
        x.innerHTML = "The request to get user location timed out."
        break;
        case error.UNKNOWN_ERROR:
        x.innerHTML = "An unknown error occurred."
        break;
    }
    }
       

    //Canva Sketch
    document.addEventListener("DOMContentLoaded", function () {
        const canvas = document.getElementById("drawingCanvas");
        const context = canvas.getContext("2d");
        let isDrawing = false;

        // Adjust the coordinates to be relative to the canvas
        function getMousePosition(event) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: event.clientX - rect.left,
                y: event.clientY - rect.top
            };
        }

        canvas.addEventListener("mousedown", (event) => {
            isDrawing = true;
            const pos = getMousePosition(event);
            context.beginPath();
            context.moveTo(pos.x, pos.y);
        });

        canvas.addEventListener("mousemove", (event) => {
            if (!isDrawing) return;
            const pos = getMousePosition(event);
            context.lineTo(pos.x, pos.y);
            context.stroke();
        });

        canvas.addEventListener("mouseup", () => {
            isDrawing = false;
        });

        document.getElementById("clearButton").addEventListener("click", () => {
            context.clearRect(0, 0, canvas.width, canvas.height);
            event.preventDefault();
        });
    });

    function validateAddReportForm() {
            
        var el_AddReport = document.getElementById('frmAddReport');
        var btn = document.getElementById('submitAddReport');
       
        var errorsAddReport = "";            
        var i;
        var counter;
        for (i = 0; i < el_AddReport.length - 3; i++) {
                if(el_AddReport.elements[i].value === "" || el_AddReport.elements[i].value === 0){                   
                    errorsAddReport += el_AddReport.elements[i].getAttribute("id") + " cannot be empty." + "<br>";
                    counter++;
                }
        }
                
        if(errorsAddReport.length > 10){
             btn.addEventListener('click', (e) => {
                e.preventDefault();                
            });

            ReportAddError("Error Adding Report",errorsAddReport);
        }else{
            el_AddReport.submit();
        }  
                        
    }

    function validateAddVehicleForm() {
        
        var el_AddVehicle = document.getElementById('frmAddVehicle');
        var btn = document.getElementById('submitAddVehicle');

        var errorsAddVehicle = "";
        var i;
        var counter;
        for (i = 0; i < el_AddVehicle.length; i++) {
                if((el_AddVehicle.elements[i].value === "" || el_AddVehicle.elements[i].value === 0)
                    && el_AddVehicle.elements[i].getAttribute("id") !== "submitAddVehicle"){
                    errorsAddVehicle += el_AddVehicle.elements[i].getAttribute("id") + " cannot be empty" + "<br>";
                    counter++;
                }
        }

        if(errorsAddVehicle.length > 0){
             btn.addEventListener('click', (e) => {
                e.preventDefault();                
            });

            ReportAddError("Error Adding Vehicle",errorsAddVehicle);
        }else{
            el_AddVehicle.submit();
        }
       
    }

    function validateAddDriverInforForm() {
        
        var el_DriverInfor = document.getElementById('frmAddDriverInfor');
        var btn = document.getElementById('submitAddDriverInfor');

        var errorsDriverInfor = "";
        var i;
        var counter;
        for (i = 0; i < el_DriverInfor.length; i++) {
                if((el_DriverInfor.elements[i].value === "" || el_DriverInfor.elements[i].value === 0 )
                     && el_DriverInfor.elements[i].getAttribute("id") !== "submitAddDriverInfor"){
                    errorsDriverInfor += el_DriverInfor.elements[i].getAttribute("id") + " cannot be empty" + "<br>";
                    counter++;
                }
        }

        if(errorsDriverInfor.length > 10){
             btn.addEventListener('click', (e) => {
                e.preventDefault();                
            });

            ReportAddError("Error Adding Driver Infor",errorsDriverInfor);
        }else{
            el_DriverInfor.submit();
        }

    }

    function validateAddRoadFactorsForm() {
        
        var el_AddRoadFactors = document.getElementById('frmAddRoadFactors');
        var btn = document.getElementById('submitAddRoadFactors');

        var errorsRoadFactors = "";
        var i;
        var counter;
        for (i = 0; i < el_AddRoadFactors.length; i++) {
                if((el_AddRoadFactors.elements[i].value === "" || el_AddRoadFactors.elements[i].value === 0)
                    && el_AddRoadFactors.elements[i].getAttribute("id") !== "submitAddRoadFactors"){
                    errorsRoadFactors += el_AddRoadFactors.elements[i].getAttribute("id") + " cannot be empty" + "<br>";
                    counter++;
                }
        }

        if(errorsRoadFactors.length > 10){
             btn.addEventListener('click', (e) => {
                e.preventDefault();                
            });

            ReportAddError("Error Adding Road Factors",errorsRoadFactors);
        }else{
            el_AddRoadFactors.submit();
        }

    }

    
    
</script>
